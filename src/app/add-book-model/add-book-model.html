<div class="modal-backdrop"
     [class.show]="isVisible"
     [style.display]="isVisible ? 'block' : 'none'"
     [attr.aria-hidden]="(!isVisible).toString()"></div>
<div class="modal" tabindex="-1" role="dialog" [class.show]="isVisible" [style.display]="isVisible ? 'block' : 'none'">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">{{ mode === 'edit' ? 'Edit Book' : 'Add New Book' }}</h5>
                <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
            </div>

            <div class="modal-body">
                <form (ngSubmit)="onSubmit()" #bookForm="ngForm">

                    <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
                        {{ errorMessage }}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="title" class="form-label fw-medium">Title *</label>
                            <input type="text" id="title" class="form-control" name="title" [(ngModel)]="newBook.title"
                                required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="author" class="form-label fw-medium">Author *</label>
                            <input type="text" id="author" class="form-control" name="author"
                                [(ngModel)]="newBook.author" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="isbn" class="form-label fw-medium">ISBN *</label>
                            <input type="text" id="isbn" class="form-control" name="isbn" [(ngModel)]="newBook.isbn"
                                required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="category" class="form-label fw-medium">Category *</label>
                            <select id="category" class="form-select" name="category" [(ngModel)]="newBook.category"
                                required>
                                <option value="" disabled>Select a category</option>
                                <option *ngFor="let category of categories" [value]="category.name">
                                    {{ category.name }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="publishedYear" class="form-label fw-medium">Published Year</label>
                            <input type="number" id="publishedYear" class="form-control" name="publishedYear"
                                [(ngModel)]="newBook.publishedYear">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="stock" class="form-label fw-medium">Stock *</label>
                            <input type="number" id="stock" class="form-control" name="stock"
                                [(ngModel)]="newBook.stock" required min="1">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 mb-3">
                            <label for="description" class="form-label fw-medium">Description</label>
                            <textarea id="description"
                                      class="form-control"
                                      name="description"
                                      rows="3"
                                      [(ngModel)]="newBook.description"
                                      placeholder="Short summary or notes about the book"></textarea>
                        </div>
                    </div>

                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-custom-orange" [disabled]="bookForm.invalid || isSubmitting"
                    (click)="onSubmit()">
                    <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status"
                        aria-hidden="true"></span>
                    {{ isSubmitting ? (mode === 'edit' ? 'Saving...' : 'Adding...') : (mode === 'edit' ? 'Save Changes' : 'Add Book') }}
                </button>
            </div>
        </div>
    </div>
</div>