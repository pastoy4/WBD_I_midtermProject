<main class="app-main-content">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-dark fw-bold">Book Inventory</h1>

        <button class="btn btn-custom-orange shadow-sm" (click)="openAddModal()">
            <i class="bi bi-plus-lg me-2"></i> Add New Book
        </button>

    </div>

    <div class="card shadow-lg border-0 rounded-3 h-100">

        <div class="card-header bg-white border-0 pt-3 pb-0">
            <h5 class="card-title text-dark fw-bold mb-3">All Library Books</h5>

            <div class="d-flex flex-wrap gap-3 mb-3 align-items-center">
                <div class="input-group search-input-group flex-grow-1">
                    <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control border-start-0 search-input"
                        placeholder="Search by title, author, ISBN, or category..." aria-label="Search books"
                        [ngModel]="searchTerm" (ngModelChange)="onSearchTermChange($event)">
                </div>
            </div>
        </div>

        <div class="card-body p-0">

            <div class="table-responsive" *ngIf="filteredBooks.length > 0">
                <table class="table table-hover table-borderless align-middle mb-0 table-custom">
                    <thead class="sticky-top">
                        <tr>
                            <th scope="col" class="py-3 px-4">No</th>
                            <th scope="col" class="py-3">Title</th>
                            <th scope="col" class="py-3">Author</th>
                            <th scope="col" class="py-3">Category</th>
                            <th scope="col" class="py-3">Description</th>
                            <th scope="col" class="py-3">ISBN</th>
                            <th scope="col" class="py-3">Stock</th>
                            <th scope="col" class="py-3 text-end px-4">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let book of filteredBooks; let i = index; trackBy: trackByBookId">
                            <td class="py-3 px-4">{{ i + 1 }}</td>
                            <td>{{ book.title }}</td>
                            <td>{{ book.author }}</td>
                            <td>{{ book.category }}</td>
                            <td class="text-muted">{{ book.description || 'â€”' }}</td>
                            <td>{{ book.isbn }}</td>
                            <td>{{ book.stock | number }}</td>
                            <td class="text-end px-4">
                                <button class="btn btn-sm btn-outline-dark me-2" title="Edit"
                                    (click)="openEditModal(book)">
                                    <i class="bi bi-pencil-square"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-outline-danger" title="Delete"
                                    [disabled]="deletingBookId === book._id"
                                    (click)="onDeleteBook(book._id, book.title)">
                                    <span *ngIf="deletingBookId !== book._id">
                                    <i class="bi bi-trash"></i> Delete
                                    </span>
                                    <span *ngIf="deletingBookId === book._id" class="d-inline-flex align-items-center gap-2">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                        Removing...
                                    </span>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="filteredBooks.length === 0" class="p-5 text-center text-secondary">
                <i class="bi bi-book display-4 mb-3"></i>
                <p *ngIf="books.length === 0">No books found in the inventory.</p>
                <p *ngIf="books.length > 0">No books match your search criteria.</p>
            </div>
        </div>

        <div class="card-footer bg-white border-0 py-3 text-end">
            <small class="text-secondary">Displaying {{ filteredBooks.length }} of {{ books.length }} books</small>
        </div>
    </div>
    <app-add-book-modal [isVisible]="isModalVisible" [mode]="modalMode" [bookToEdit]="selectedBook"
        (close)="onModalClosed()" (saved)="onBookSaved()">
    </app-add-book-modal>
</main>